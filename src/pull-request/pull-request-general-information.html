<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">

<link rel="import" href="pull-request-comment.html">

<dom-module id="pull-request-general-information">
  <template>
    <style>
      :host {
        display: block;
      }
      .pr-text {
        flex:1;
      }
      .pr-time {
        text-align: right;
      }
      .pr-topinfo {
        display:flex;
      }
      .review-true {
        width:17px;
        height:17px;
        color:white;
        background-color: var(--primary-action-green);
        border-radius: 8px;
      }
      .review-false {
        width:17px;
        height:17px;
        background-color: var(--primary-action-red);
        color:white;
        border-radius: 8px;
      }
      .pr-right-side {
        display:block;
      }
      .pr-info{
        width: 52px;
        height: 52px;
      }
      .pr-repeat{
        display:flex;
      }
      .comment-input{
        width: 100%;
      }
      .button{
        float: right;
      }
    </style>
    <div class="overview">
      <div class="pr-topinfo">
        <div class="pr-text">
          <h1>[[pr.title]]</h1>
          <span>[[pr.description]]</span>
        </div>
        <div class="pr-right-side">
          <p>[[pr.timeopened]] ago</p>
          <div class="pr-repeat">
            <template is="dom-repeat" items="[[pr.reviewers]]" as="reviewers">
              <div class="pr-info" style$="background-image: url([[reviewers.profile]]); background-repeat: no-repeat; background-size: 50px 50px;">
                <template is="dom-if" if="[[_equals(reviewers.lgtm,'true')]]" restamp="true">
                  <iron-icon class="review-true", icon="icons:check-circle"></iron-icon>
                </template>
                <template is="dom-if" if="[[!_equals(reviewers.lgtm,'true')]]" restamp="true">
                  <iron-icon class="review-false", icon="icons:cancel"></iron-icon>
                </template>
              </div>
            </template>
          </div>
        </div>
      </div>
      <h3>Comments:</h3>
        <template is="dom-repeat" items="[[pr.comments]]">
          <pull-request-comment comment="[[item]]"></pull-request-comment>
        </template>
        <paper-textarea class="comment-input" value="{{newtext}}"></paper-textarea>
        <paper-button raised class="button" on-tap="_addComment">New comment</paper-button>
    </div>
  </template>
  <script>
    Polymer({
      is: 'pull-request-general-information',
      properties: {
        pr: Object,
        newtext: String
      },
      _equals: function(one, other) {
        return one === other;
      },
      _addComment: function() {
        var newComment = {};
        if(this.newtext.replace(/\s/g, '') !== ""){
          newComment.text = this.newtext;
          newComment.poster = "Eva";
          newComment.timeopened = "12 hours";
          this.push('pr.comments', newComment);
          this.newtext = "";
        }
      }
    });
  </script>
</dom-module>
